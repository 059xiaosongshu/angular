import { global } from 'angular2/src/facade/lang';
/**
 * Stores error information; delivered via [NgZone.onError] stream.
 */
export class NgZoneError {
    constructor(error, stackTrace) {
        this.error = error;
        this.stackTrace = stackTrace;
    }
}
export class NgZoneImpl {
    constructor({ trace, onEnter, onLeave, setMicrotask, setMacrotask, onError }) {
        this.name = 'angular';
        this.properties = { 'isAngularZone': true };
        this.onEnter = onEnter;
        this.onLeave = onLeave;
        this.setMicrotask = setMicrotask;
        this.setMacrotask = setMacrotask;
        this.onError = onError;
        if (global.Zone) {
            this.outer = this.inner = Zone.current;
            if (Zone['wtfZoneSpec']) {
                this.inner = this.inner.fork(Zone['wtfZoneSpec']);
            }
            if (trace) {
                this.inner = this.inner.fork(Zone['longStackTraceZoneSpec']);
            }
            this.inner = this.inner.fork(this);
        }
        else {
            throw new Error('Angular2 needs to be run with Zone.js polyfill.');
        }
    }
    static isInAngularZone() { return Zone.current.get('isAngularZone') === true; }
    onInvokeTask(delegate, current, target, task, applyThis, applyArgs) {
        try {
            this.onEnter();
            return delegate.invokeTask(target, task, applyThis, applyArgs);
        }
        finally {
            this.onLeave();
        }
    }
    ;
    onInvoke(delegate, current, target, callback, applyThis, applyArgs, source) {
        try {
            this.onEnter();
            return delegate.invoke(target, callback, applyThis, applyArgs, source);
        }
        finally {
            this.onLeave();
        }
    }
    onHasTask(delegate, current, target, hasTaskState) {
        delegate.hasTask(target, hasTaskState);
        if (current == target) {
            // We are only interested in hasTask events which originate from our zone
            // (A child hasTask event is not interesting to us)
            if (hasTaskState.change == 'microTask') {
                this.setMicrotask(hasTaskState.microTask);
            }
            else if (hasTaskState.change == 'macroTask') {
                this.setMacrotask(hasTaskState.macroTask);
            }
        }
    }
    onHandleError(delegate, current, target, error) {
        delegate.handleError(target, error);
        this.onError(new NgZoneError(error, error.stack));
        return false;
    }
    runInner(fn) { return this.inner.runGuarded(fn); }
    ;
    runOuter(fn) { return this.outer.run(fn); }
    ;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmdfem9uZV9pbXBsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYW5ndWxhcjIvc3JjL2NvcmUvem9uZS9uZ196b25lX2ltcGwudHMiXSwibmFtZXMiOlsiTmdab25lRXJyb3IiLCJOZ1pvbmVFcnJvci5jb25zdHJ1Y3RvciIsIk5nWm9uZUltcGwiLCJOZ1pvbmVJbXBsLmNvbnN0cnVjdG9yIiwiTmdab25lSW1wbC5pc0luQW5ndWxhclpvbmUiLCJOZ1pvbmVJbXBsLm9uSW52b2tlVGFzayIsIk5nWm9uZUltcGwub25JbnZva2UiLCJOZ1pvbmVJbXBsLm9uSGFzVGFzayIsIk5nWm9uZUltcGwub25IYW5kbGVFcnJvciIsIk5nWm9uZUltcGwucnVuSW5uZXIiLCJOZ1pvbmVJbXBsLnJ1bk91dGVyIl0sIm1hcHBpbmdzIjoiT0FBTyxFQUFDLE1BQU0sRUFBQyxNQUFNLDBCQUEwQjtBQUUvQzs7R0FFRztBQUNIO0lBQ0VBLFlBQW1CQSxLQUFVQSxFQUFTQSxVQUFlQTtRQUFsQ0MsVUFBS0EsR0FBTEEsS0FBS0EsQ0FBS0E7UUFBU0EsZUFBVUEsR0FBVkEsVUFBVUEsQ0FBS0E7SUFBR0EsQ0FBQ0E7QUFDM0RELENBQUNBO0FBR0Q7SUFlRUUsWUFBWUEsRUFBQ0EsS0FBS0EsRUFBRUEsT0FBT0EsRUFBRUEsT0FBT0EsRUFBRUEsWUFBWUEsRUFBRUEsWUFBWUEsRUFBRUEsT0FBT0EsRUFPeEVBO1FBbkJNQyxTQUFJQSxHQUFXQSxTQUFTQSxDQUFDQTtRQUN6QkEsZUFBVUEsR0FBK0JBLEVBQUNBLGVBQWVBLEVBQUVBLElBQUlBLEVBQUNBLENBQUNBO1FBbUJ0RUEsSUFBSUEsQ0FBQ0EsT0FBT0EsR0FBR0EsT0FBT0EsQ0FBQ0E7UUFDdkJBLElBQUlBLENBQUNBLE9BQU9BLEdBQUdBLE9BQU9BLENBQUNBO1FBQ3ZCQSxJQUFJQSxDQUFDQSxZQUFZQSxHQUFHQSxZQUFZQSxDQUFDQTtRQUNqQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsR0FBR0EsWUFBWUEsQ0FBQ0E7UUFDakNBLElBQUlBLENBQUNBLE9BQU9BLEdBQUdBLE9BQU9BLENBQUNBO1FBRXZCQSxFQUFFQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNoQkEsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0E7WUFDdkNBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dCQUN4QkEsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDcERBLENBQUNBO1lBQ0RBLEVBQUVBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBO2dCQUNWQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSx3QkFBd0JBLENBQUNBLENBQUNBLENBQUNBO1lBQy9EQSxDQUFDQTtZQUNEQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUNyQ0EsQ0FBQ0E7UUFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDTkEsTUFBTUEsSUFBSUEsS0FBS0EsQ0FBQ0EsaURBQWlEQSxDQUFDQSxDQUFDQTtRQUNyRUEsQ0FBQ0E7SUFDSEEsQ0FBQ0E7SUF4Q0RELE9BQU9BLGVBQWVBLEtBQWNFLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLEdBQUdBLENBQUNBLGVBQWVBLENBQUNBLEtBQUtBLElBQUlBLENBQUNBLENBQUNBLENBQUNBO0lBMEN4RkYsWUFBWUEsQ0FBQ0EsUUFBc0JBLEVBQUVBLE9BQWFBLEVBQUVBLE1BQVlBLEVBQUVBLElBQVVBLEVBQUVBLFNBQWNBLEVBQy9FQSxTQUFjQTtRQUN6QkcsSUFBSUEsQ0FBQ0E7WUFDSEEsSUFBSUEsQ0FBQ0EsT0FBT0EsRUFBRUEsQ0FBQ0E7WUFDZkEsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsTUFBTUEsRUFBRUEsSUFBSUEsRUFBRUEsU0FBU0EsRUFBRUEsU0FBU0EsQ0FBQ0EsQ0FBQ0E7UUFDakVBLENBQUNBO2dCQUFTQSxDQUFDQTtZQUNUQSxJQUFJQSxDQUFDQSxPQUFPQSxFQUFFQSxDQUFDQTtRQUNqQkEsQ0FBQ0E7SUFDSEEsQ0FBQ0E7O0lBR0RILFFBQVFBLENBQUNBLFFBQXNCQSxFQUFFQSxPQUFhQSxFQUFFQSxNQUFZQSxFQUFFQSxRQUFrQkEsRUFBRUEsU0FBY0EsRUFDdkZBLFNBQWdCQSxFQUFFQSxNQUFjQTtRQUN2Q0ksSUFBSUEsQ0FBQ0E7WUFDSEEsSUFBSUEsQ0FBQ0EsT0FBT0EsRUFBRUEsQ0FBQ0E7WUFDZkEsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsTUFBTUEsRUFBRUEsUUFBUUEsRUFBRUEsU0FBU0EsRUFBRUEsU0FBU0EsRUFBRUEsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFDekVBLENBQUNBO2dCQUFTQSxDQUFDQTtZQUNUQSxJQUFJQSxDQUFDQSxPQUFPQSxFQUFFQSxDQUFDQTtRQUNqQkEsQ0FBQ0E7SUFDSEEsQ0FBQ0E7SUFFREosU0FBU0EsQ0FBQ0EsUUFBc0JBLEVBQUVBLE9BQWFBLEVBQUVBLE1BQVlBLEVBQUVBLFlBQTBCQTtRQUN2RkssUUFBUUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsTUFBTUEsRUFBRUEsWUFBWUEsQ0FBQ0EsQ0FBQ0E7UUFDdkNBLEVBQUVBLENBQUNBLENBQUNBLE9BQU9BLElBQUlBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO1lBQ3RCQSx5RUFBeUVBO1lBQ3pFQSxtREFBbURBO1lBQ25EQSxFQUFFQSxDQUFDQSxDQUFDQSxZQUFZQSxDQUFDQSxNQUFNQSxJQUFJQSxXQUFXQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDdkNBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLFlBQVlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBO1lBQzVDQSxDQUFDQTtZQUFDQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxZQUFZQSxDQUFDQSxNQUFNQSxJQUFJQSxXQUFXQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDOUNBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLFlBQVlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBO1lBQzVDQSxDQUFDQTtRQUNIQSxDQUFDQTtJQUNIQSxDQUFDQTtJQUVETCxhQUFhQSxDQUFDQSxRQUFzQkEsRUFBRUEsT0FBYUEsRUFBRUEsTUFBWUEsRUFBRUEsS0FBVUE7UUFDM0VNLFFBQVFBLENBQUNBLFdBQVdBLENBQUNBLE1BQU1BLEVBQUVBLEtBQUtBLENBQUNBLENBQUNBO1FBQ3BDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxJQUFJQSxXQUFXQSxDQUFDQSxLQUFLQSxFQUFFQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNsREEsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0E7SUFDZkEsQ0FBQ0E7SUFFRE4sUUFBUUEsQ0FBQ0EsRUFBYUEsSUFBU08sTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7O0lBQ2xFUCxRQUFRQSxDQUFDQSxFQUFhQSxJQUFTUSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTs7QUFDN0RSLENBQUNBO0FBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2dsb2JhbH0gZnJvbSAnYW5ndWxhcjIvc3JjL2ZhY2FkZS9sYW5nJztcblxuLyoqXG4gKiBTdG9yZXMgZXJyb3IgaW5mb3JtYXRpb247IGRlbGl2ZXJlZCB2aWEgW05nWm9uZS5vbkVycm9yXSBzdHJlYW0uXG4gKi9cbmV4cG9ydCBjbGFzcyBOZ1pvbmVFcnJvciB7XG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBlcnJvcjogYW55LCBwdWJsaWMgc3RhY2tUcmFjZTogYW55KSB7fVxufVxuXG5cbmV4cG9ydCBjbGFzcyBOZ1pvbmVJbXBsIGltcGxlbWVudHMgWm9uZVNwZWMge1xuICBzdGF0aWMgaXNJbkFuZ3VsYXJab25lKCk6IGJvb2xlYW4geyByZXR1cm4gWm9uZS5jdXJyZW50LmdldCgnaXNBbmd1bGFyWm9uZScpID09PSB0cnVlOyB9XG5cbiAgcHVibGljIG5hbWU6IHN0cmluZyA9ICdhbmd1bGFyJztcbiAgcHVibGljIHByb3BlcnRpZXM6IHtbazogc3RyaW5nXTogc3RyaW5nfSA9IDxhbnk+eydpc0FuZ3VsYXJab25lJzogdHJ1ZX07XG5cbiAgcHJpdmF0ZSBvdXRlcjogWm9uZTtcbiAgcHJpdmF0ZSBpbm5lcjogWm9uZTtcblxuICBwcml2YXRlIG9uRW50ZXI6ICgpID0+IHZvaWQ7XG4gIHByaXZhdGUgb25MZWF2ZTogKCkgPT4gdm9pZDtcbiAgcHJpdmF0ZSBzZXRNaWNyb3Rhc2s6IChoYXNNaWNyb3Rhc2tzOiBib29sZWFuKSA9PiB2b2lkO1xuICBwcml2YXRlIHNldE1hY3JvdGFzazogKGhhc01hY3JvdGFza3M6IGJvb2xlYW4pID0+IHZvaWQ7XG4gIHByaXZhdGUgb25FcnJvcjogKGVycm9yOiBOZ1pvbmVFcnJvcikgPT4gdm9pZDtcblxuICBjb25zdHJ1Y3Rvcih7dHJhY2UsIG9uRW50ZXIsIG9uTGVhdmUsIHNldE1pY3JvdGFzaywgc2V0TWFjcm90YXNrLCBvbkVycm9yfToge1xuICAgIHRyYWNlOiBib29sZWFuLFxuICAgIG9uRW50ZXI6ICgpID0+IHZvaWQsXG4gICAgb25MZWF2ZTogKCkgPT4gdm9pZCxcbiAgICBzZXRNaWNyb3Rhc2s6IChoYXNNaWNyb3Rhc2tzOiBib29sZWFuKSA9PiB2b2lkLFxuICAgIHNldE1hY3JvdGFzazogKGhhc01hY3JvdGFza3M6IGJvb2xlYW4pID0+IHZvaWQsXG4gICAgb25FcnJvcjogKGVycm9yOiBOZ1pvbmVFcnJvcikgPT4gdm9pZFxuICB9KSB7XG4gICAgdGhpcy5vbkVudGVyID0gb25FbnRlcjtcbiAgICB0aGlzLm9uTGVhdmUgPSBvbkxlYXZlO1xuICAgIHRoaXMuc2V0TWljcm90YXNrID0gc2V0TWljcm90YXNrO1xuICAgIHRoaXMuc2V0TWFjcm90YXNrID0gc2V0TWFjcm90YXNrO1xuICAgIHRoaXMub25FcnJvciA9IG9uRXJyb3I7XG5cbiAgICBpZiAoZ2xvYmFsLlpvbmUpIHtcbiAgICAgIHRoaXMub3V0ZXIgPSB0aGlzLmlubmVyID0gWm9uZS5jdXJyZW50O1xuICAgICAgaWYgKFpvbmVbJ3d0ZlpvbmVTcGVjJ10pIHtcbiAgICAgICAgdGhpcy5pbm5lciA9IHRoaXMuaW5uZXIuZm9yayhab25lWyd3dGZab25lU3BlYyddKTtcbiAgICAgIH1cbiAgICAgIGlmICh0cmFjZSkge1xuICAgICAgICB0aGlzLmlubmVyID0gdGhpcy5pbm5lci5mb3JrKFpvbmVbJ2xvbmdTdGFja1RyYWNlWm9uZVNwZWMnXSk7XG4gICAgICB9XG4gICAgICB0aGlzLmlubmVyID0gdGhpcy5pbm5lci5mb3JrKHRoaXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0FuZ3VsYXIyIG5lZWRzIHRvIGJlIHJ1biB3aXRoIFpvbmUuanMgcG9seWZpbGwuJyk7XG4gICAgfVxuICB9XG5cbiAgb25JbnZva2VUYXNrKGRlbGVnYXRlOiBab25lRGVsZWdhdGUsIGN1cnJlbnQ6IFpvbmUsIHRhcmdldDogWm9uZSwgdGFzazogVGFzaywgYXBwbHlUaGlzOiBhbnksXG4gICAgICAgICAgICAgICBhcHBseUFyZ3M6IGFueSk6IGFueSB7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMub25FbnRlcigpO1xuICAgICAgcmV0dXJuIGRlbGVnYXRlLmludm9rZVRhc2sodGFyZ2V0LCB0YXNrLCBhcHBseVRoaXMsIGFwcGx5QXJncyk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHRoaXMub25MZWF2ZSgpO1xuICAgIH1cbiAgfTtcblxuXG4gIG9uSW52b2tlKGRlbGVnYXRlOiBab25lRGVsZWdhdGUsIGN1cnJlbnQ6IFpvbmUsIHRhcmdldDogWm9uZSwgY2FsbGJhY2s6IEZ1bmN0aW9uLCBhcHBseVRoaXM6IGFueSxcbiAgICAgICAgICAgYXBwbHlBcmdzOiBhbnlbXSwgc291cmNlOiBzdHJpbmcpOiBhbnkge1xuICAgIHRyeSB7XG4gICAgICB0aGlzLm9uRW50ZXIoKTtcbiAgICAgIHJldHVybiBkZWxlZ2F0ZS5pbnZva2UodGFyZ2V0LCBjYWxsYmFjaywgYXBwbHlUaGlzLCBhcHBseUFyZ3MsIHNvdXJjZSk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHRoaXMub25MZWF2ZSgpO1xuICAgIH1cbiAgfVxuXG4gIG9uSGFzVGFzayhkZWxlZ2F0ZTogWm9uZURlbGVnYXRlLCBjdXJyZW50OiBab25lLCB0YXJnZXQ6IFpvbmUsIGhhc1Rhc2tTdGF0ZTogSGFzVGFza1N0YXRlKSB7XG4gICAgZGVsZWdhdGUuaGFzVGFzayh0YXJnZXQsIGhhc1Rhc2tTdGF0ZSk7XG4gICAgaWYgKGN1cnJlbnQgPT0gdGFyZ2V0KSB7XG4gICAgICAvLyBXZSBhcmUgb25seSBpbnRlcmVzdGVkIGluIGhhc1Rhc2sgZXZlbnRzIHdoaWNoIG9yaWdpbmF0ZSBmcm9tIG91ciB6b25lXG4gICAgICAvLyAoQSBjaGlsZCBoYXNUYXNrIGV2ZW50IGlzIG5vdCBpbnRlcmVzdGluZyB0byB1cylcbiAgICAgIGlmIChoYXNUYXNrU3RhdGUuY2hhbmdlID09ICdtaWNyb1Rhc2snKSB7XG4gICAgICAgIHRoaXMuc2V0TWljcm90YXNrKGhhc1Rhc2tTdGF0ZS5taWNyb1Rhc2spO1xuICAgICAgfSBlbHNlIGlmIChoYXNUYXNrU3RhdGUuY2hhbmdlID09ICdtYWNyb1Rhc2snKSB7XG4gICAgICAgIHRoaXMuc2V0TWFjcm90YXNrKGhhc1Rhc2tTdGF0ZS5tYWNyb1Rhc2spO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG9uSGFuZGxlRXJyb3IoZGVsZWdhdGU6IFpvbmVEZWxlZ2F0ZSwgY3VycmVudDogWm9uZSwgdGFyZ2V0OiBab25lLCBlcnJvcjogYW55KTogYm9vbGVhbiB7XG4gICAgZGVsZWdhdGUuaGFuZGxlRXJyb3IodGFyZ2V0LCBlcnJvcik7XG4gICAgdGhpcy5vbkVycm9yKG5ldyBOZ1pvbmVFcnJvcihlcnJvciwgZXJyb3Iuc3RhY2spKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBydW5Jbm5lcihmbjogKCkgPT4gYW55KTogYW55IHsgcmV0dXJuIHRoaXMuaW5uZXIucnVuR3VhcmRlZChmbik7IH07XG4gIHJ1bk91dGVyKGZuOiAoKSA9PiBhbnkpOiBhbnkgeyByZXR1cm4gdGhpcy5vdXRlci5ydW4oZm4pOyB9O1xufVxuIl19